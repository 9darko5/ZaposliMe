name: Build & Deploy Blazor WASM to SWA (auto-build)

on:
  push:
    branches: [ main ]
  pull_request:
    types: [opened, synchronize, reopened, closed]
    branches: [ main ]

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Optional but recommended: Use consistent .NET SDK for local restores or generators (not required by the SWA action).
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.415'

      # If you use workloads locally (WASM tools), you can restore to prevent surprises:
      - name: Restore workloads (optional)
        run: dotnet workload restore

      # The SWA action will run the build using Oryx. We just point it to the app folder and output folder.
      - name: Build & Deploy to Azure Static Web Apps
        id: swa
        uses: Azure/static-web-apps-deploy@v1
        with:
          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }}
          # The folder that contains your Blazor WASM project file
          app_location: ZaposliMeFrontend
          # The STATIC FILES output folder expected after build.
          # For Blazor WASM, Oryx publishes to a 'wwwroot' output.
          output_location: wwwroot
          production_branch: main

      # Optional: add a comment with the deployed URL on PRs
      - name: Comment deployment URL (PRs only)
        if: ${{ github.event_name == 'pull_request' && steps.swa.outputs.static_web_app_url != '' }}
        uses: mshick/add-pr-comment@v2
        with:
          message: |
            Preview deployed: ${{ steps.swa.outputs.static_web_app_url }}
