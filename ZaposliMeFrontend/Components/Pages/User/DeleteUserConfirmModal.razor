@using Microsoft.AspNetCore.Components
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<ZaposliMe.Frontend.Resources.Resources> L

@if (IsOpen)
{
    <!-- Backdrop -->
    <div class="modal-backdrop fade show"></div>

    <!-- Modal -->
    <div class="modal fade show d-block" tabindex="-1" role="dialog" aria-modal="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content rounded-4 shadow">
                <div class="modal-header">
                    <h5 class="modal-title">@EffectiveTitle</h5>
                    <button type="button" class="btn-close" aria-label="@L["Close"]" @onclick="CloseAsync"></button>
                </div>

                <div class="modal-body">
                    <p class="mb-0">@EffectiveMessage</p>

                    @if (!string.IsNullOrWhiteSpace(ErrorMessage))
                    {
                        <div class="alert alert-danger mt-3 mb-0">@ErrorMessage</div>
                    }
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" @onclick="CloseAsync" disabled="@Busy">
                        @EffectiveCancelText
                    </button>
                    <button class="btn btn-danger" @onclick="ConfirmAsync" disabled="@Busy">
                        @if (Busy)
                        {
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                        }
                        @EffectiveConfirmText
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    // State
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public bool Busy { get; set; }
    [Parameter] public string? ErrorMessage { get; set; }

    // Callbacks
    [Parameter] public EventCallback OnClose { get; set; }
    [Parameter] public EventCallback OnConfirm { get; set; }

    // Optional text overrides (renamed to avoid clashes with methods)
    [Parameter] public string? TitleOverride { get; set; }
    [Parameter] public string? MessageOverride { get; set; }
    [Parameter] public string? CancelTextOverride { get; set; }
    [Parameter] public string? ConfirmTextOverride { get; set; }

    // Effective texts
    private string EffectiveTitle => string.IsNullOrWhiteSpace(TitleOverride) ? L["ConfirmDeleteTitle"] : TitleOverride!;
    private string EffectiveMessage => string.IsNullOrWhiteSpace(MessageOverride) ? L["ConfirmDeleteMessage"] : MessageOverride!;
    private string EffectiveCancelText => string.IsNullOrWhiteSpace(CancelTextOverride) ? L["Cancel"] : CancelTextOverride!;
    private string EffectiveConfirmText => string.IsNullOrWhiteSpace(ConfirmTextOverride) ? L["YesDelete"] : ConfirmTextOverride!;

    // Methods
    private Task CloseAsync() => Busy ? Task.CompletedTask : OnClose.InvokeAsync();
    private Task ConfirmAsync() => OnConfirm.InvokeAsync();
}
